# U4EIP：基于 U-Net 的电磁特性恢复系统

## 📋 概述

一个基于卷积神经网络的电磁特性恢复系统，通过轻量级U-Net模型从电磁波传播数据中精确恢复介质的电磁特性（如介电常数分布）。

---

## 🎯 设计原理

### 1. **问题定义**
- **输入**：模拟的电磁波传播数据（64×64矩阵）
- **输出**：介质的电磁特性分布（64×64矩阵）
- **任务**：从观测数据反演介质物理参数

### 2. **核心思路**

#### 数据层：圆形图案生成
```
圆形掩膜 (Circle Mask)
├─ 圆心内部: 数值 = 1.0 (深色，代表高介电常数)
├─ 圆心外部: 数值 = 0.2 (浅色，代表低介电常数)
└─ 模拟真实电磁介质的空间分布特征
```

数据增强策略：
- **旋转变换**：增加模型对方向不变性的学习
- **高斯噪声**：模拟真实测量误差（σ=0.02）
- **归一化处理**：保证数值稳定性和收敛速度

#### 模型层：轻量级U-Net架构
```
编码器 (Encoder)
    ↓ Conv2D × 2 → MaxPooling (× 3 层)
    ↓
Bottleneck
    ↓ Conv2D × 2
    ↓
解码器 (Decoder)
    ↓ UpSampling → Concat → Conv2D × 2 (× 3 层)
    ↓
输出层 (Sigmoid激活)
```

#### 训练层：二值分类损失
```python
损失函数: Binary Crossentropy
优化器: Adam (lr=0.001)
正则化: 早停机制 (patience=10)
```

#### 推理层：阈值强化处理
```python
后处理规则:
├─ 高值区域 (≥0.8) → 向上取整 = 1.0
├─ 低值区域 (≤0.3) → 向下取整 = 0.0
└─ 中间值 (0.3~0.8) → 保持原值
```

**强化效果**：
- 去除预测中的模糊不确定性
- 增强二值化分割效果
- 接近真实物理模型（介质存在/不存在）

---


### 3. **可配置化架构**
```python
CONFIG = {
    'num_samples': 500,      # 易于调整数据规模
    'base_filters': 32,      # 可扩展模型容量
    'depth': 3,              # 灵活调整网络深度
    'epochs': 60,            # 自适应训练轮数
    'learning_rate': 0.001,  # 独立的学习率控制
}
```

### 4. **模块化代码结构**
```
数据生成模块 ──→ 模型构建模块 ──→ 训练评估模块 ──→ 后处理与可视化
  (独立函数)      (独立函数)       (主程序逻辑)      (完整的结果输出)
```

**可维护性优势**：
- 各模块独立，易于单元测试
- 配置集中管理，便于参数调优
- 函数接口清晰，扩展性强

---


## 🔄 工作流程

```
1. 数据生成
   ├─ 生成500个圆形样本
   ├─ 旋转与噪声增强
   └─ 归一化处理

2. 模型训练
   ├─ 构建轻量级U-Net
   ├─ 60个epochs（可能早停）
   └─ 二值交叉熵优化

3. 性能评估
   ├─ 计算MSE & MAE
   ├─ 绘制训练曲线
   └─ 保存指标文件

4. 预测与强化
   ├─ 模型推理（原始预测）
   ├─ 阈值强化处理
   └─ 生成对比可视化

5. 结果输出
   ├─ training_loss.png (训练曲线)
   ├─ prediction_comparison.png (4图对比)
   └─ metrics.txt (性能指标)
```

---

## 🚀 运行指南

### 环境配置
```bash
pip install tensorflow numpy matplotlib
```

### 执行训练
```bash
cd src
python -c "exec(open('main.ipynb').read())"
# 或在Jupyter中运行main.ipynb
```

### 查看结果
```bash
ls -la results/
# 输出：
# - training_loss.png
# - prediction_comparison.png
# - metrics.txt
```

---

## 📈 预期结果

### 验证集指标
- **MSE**: < 0.01（目标）
- **MAE**: < 0.05（目标）

### 可视化对比
四张并排图像展示：
1. **Input (Circle)** - 输入电磁波数据
2. **True Label** - 真实介质分布
3. **Raw Prediction** - 模型原始预测
4. **Enhanced Prediction** - 阈值强化后结果

---

## 🔬 物理意义

| 矩阵数值 | 物理含义 | 材料例子 |
|---------|--------|---------|
| 0.2 | 低介电常数 | 空气、真空 |
| 1.0 | 高介电常数 | 陶瓷、玻璃 |

**应用场景**：
- 地下水资源勘探（GPR雷达）
- 医学成像（MRI信号反演）
- 工业无损检测（缺陷识别）


---

***Last Updated: 2025.12.11***  
